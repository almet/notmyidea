<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Alexis Métaireau - sysadmin</title><link href="https://blog.notmyidea.org/" rel="alternate"></link><link href="https://blog.notmyidea.org/feeds/tags/sysadmin.atom.xml" rel="self"></link><id>https://blog.notmyidea.org/</id><updated>2023-11-20T00:00:00+01:00</updated><entry><title>Importing a PostgreSQL dump under a different database name</title><link href="https://blog.notmyidea.org/importing-a-postgresql-dump-under-a-different-database-name.html" rel="alternate"></link><published>2023-11-20T00:00:00+01:00</published><updated>2023-11-20T00:00:00+01:00</updated><author><name></name></author><id>tag:blog.notmyidea.org,2023-11-20:/importing-a-postgresql-dump-under-a-different-database-name.html</id><summary type="html">&lt;p&gt;For &lt;a href="https://chariotte.fr"&gt;Chariotte&lt;/a&gt;, I&amp;#8217;ve had to do an import from one system to the other. I had no control on the export I received. It contained the database name and the ACLs, which I had to change to match the ones on the new&amp;nbsp;system.&lt;/p&gt;
&lt;h2 id="decrypting-the-dump"&gt;Decrypting the&amp;nbsp;dump&lt;/h2&gt;
&lt;p&gt;First off …&lt;/p&gt;</summary><content type="html">&lt;p&gt;For &lt;a href="https://chariotte.fr"&gt;Chariotte&lt;/a&gt;, I&amp;#8217;ve had to do an import from one system to the other. I had no control on the export I received. It contained the database name and the ACLs, which I had to change to match the ones on the new&amp;nbsp;system.&lt;/p&gt;
&lt;h2 id="decrypting-the-dump"&gt;Decrypting the&amp;nbsp;dump&lt;/h2&gt;
&lt;p&gt;First off, the import I received was encrypted, so I had to decrypt it. It took me some time to figure out that both my private &lt;strong&gt;and public&lt;/strong&gt; keys needed to be imported to the pgp. Once that was done, I could decrypt&amp;nbsp;with&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Decrypt the file&lt;/span&gt;
gpg&lt;span class="w"&gt; &lt;/span&gt;--decrypt&lt;span class="w"&gt; &lt;/span&gt;hb_chariotte_prod.pgdump.asc&lt;span class="w"&gt; &lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;hb_chariotte_prod.pgdump

&lt;span class="c1"&gt;# Upload it to the server with scp&lt;/span&gt;
scp&lt;span class="w"&gt; &lt;/span&gt;hb_chariotte_prod.pgdump&lt;span class="w"&gt;  &lt;/span&gt;chariotte:.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="importing-while-changing-acls-and-database-name"&gt;Importing while changing ACLs and database&amp;nbsp;name&lt;/h2&gt;
&lt;p&gt;On the server, here is the command to change the name of the database and the user. The file I received was using the so-called &amp;#8220;custom&amp;#8221; format, which is not editable with a simple editor, so you have to export it to &lt;span class="caps"&gt;SQL&lt;/span&gt; first, and then edit it before running the actual&amp;nbsp;queries.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Convert to SQL, then replace the table name with the new one, and finally run the SQL statements.&lt;/span&gt;
pg_restore&lt;span class="w"&gt; &lt;/span&gt;-C&lt;span class="w"&gt; &lt;/span&gt;-f&lt;span class="w"&gt; &lt;/span&gt;-&lt;span class="w"&gt; &lt;/span&gt;hb_chariotte_prod.pgdump&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;sed&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;s/hb_chariotte_prod/chariotte_temp/g&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;psql&lt;span class="w"&gt; &lt;/span&gt;-U&lt;span class="w"&gt; &lt;/span&gt;chariotte_temp&lt;span class="w"&gt; &lt;/span&gt;-d&lt;span class="w"&gt; &lt;/span&gt;chariotte_temp&lt;span class="w"&gt; &lt;/span&gt;-h&lt;span class="w"&gt; &lt;/span&gt;yourhost
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="code"></category><category term="postgresql"></category><category term="sysadmin"></category></entry></feed>