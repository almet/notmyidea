<!DOCTYPE html>
<html lang="fr">
    <head>
        <title>
Argos&nbsp;(Framasoft) - Alexis MÃ©taireau        </title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet"
              href="https://blog.notmyidea.org/theme/css/main.css?v2"
              type="text/css" />
        <link href="https://blog.notmyidea.org/feeds/all.atom.xml"
              type="application/atom+xml"
              rel="alternate"
              title="Alexis MÃ©taireau ATOM Feed" />
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    </head>
    <body>
        <div id="content">
            <section id="links">
                <ul>
                            <li>
                                <a class="main" href="/">Alexis MÃ©taireau</a>
                            </li>
                        <li>
                            <a class=""
                               href="https://blog.notmyidea.org/journal/index.html">Journal</a>
                        </li>
                        <li>
                            <a class=""
                               href="https://blog.notmyidea.org/code/">Code, etc.</a>
                        </li>
                        <li>
                            <a class=""
                               href="https://blog.notmyidea.org/weeknotes/">Notes hebdo</a>
                        </li>
                        <li>
                            <a class=""
                               href="https://blog.notmyidea.org/lectures/">Lectures</a>
                        </li>
                        <li>
                            <a class=""
                               href="https://blog.notmyidea.org/projets.html">Projets</a>
                        </li>
                </ul>
            </section>
  <header>
    <h1 class="post-title">Argos&nbsp;(Framasoft)</h1>
    <details>
      <summary>Stats</summary>
        <div>
â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“          102% (57h / 56 prÃ©vues)
        </div>
        <ul>
          <li>57h rÃ©munÃ©rÃ©es</li>
          <li>16h bÃ©nÃ©voles</li>
        </ul>
      <table>
        <thead>
          <tr>
            <td>Mois</td>
            <td>Heures</td>
            <td>Jours</td>
          </tr>
        </thead>
        <tbody>
            <tr>
              <td>2023/12</td>
              <td>0</td>
              <td>0.0</td>
            </tr>
            <tr>
              <td>2023/11</td>
              <td>0</td>
              <td>0.0</td>
            </tr>
            <tr>
              <td>2023/10</td>
              <td>46</td>
              <td>6.6</td>
            </tr>
            <tr>
              <td>2023/09</td>
              <td>11</td>
              <td>1.6</td>
            </tr>
        </tbody>
      </table>
    </details>
  </header>
  <article>
    <div id="vis"></div>
    <h2 id="samedi-16-decembre-2023">ğŸ—“ï¸ samedi 16 dÃ©cembre&nbsp;2023</h2>
<p>J&#8217;ai ajoutÃ© le support de <a href="https://alembic.sqlalchemy.org">Alembic</a>, pour permettre de faire des migrations de base de donnÃ©es. C&#8217;Ã©tait assez chouette de dÃ©couvrir comment Ã§a fonctionne : Ã§a fait longtemps que je l&#8217;utilise sur d&#8217;autres projets mais ce n&#8217;Ã©tait pas moi qui l&#8217;avait mis en&nbsp;place.</p>
<p>J&#8217;ai aussi passÃ© un peu de temps Ã  faire des petits changements Ã  droite Ã &nbsp;gauche.</p>
<h2 id="jeudi-14-decembre-2023">ğŸ—“ï¸ jeudi 14 dÃ©cembre&nbsp;2023</h2>
<p>Echanges avec Luc pour faire le tour des merge requests, et un petit temps de bilan gÃ©nÃ©ral sur le projet.
Content de recevoir des retours positifs sur le travail&nbsp;effectuÃ©.</p>
<h2 id="jeudi-07-decembre-2023">ğŸ—“ï¸ jeudi 07 dÃ©cembre&nbsp;2023</h2>
<p>Revue de&nbsp;code.</p>
<h2 id="jeudi-23-novembre-2023">ğŸ—“ï¸ jeudi 23 novembre&nbsp;2023</h2>
<p>J&#8217;ai fait de la revue de code (<a href="https://framagit.org/framasoft/framaspace/argos/-/merge_requests/12">pylint</a>, <a href="https://framagit.org/framasoft/framaspace/argos/-/merge_requests/13#notes">ajout des notifs mail</a>), <a href="https://framagit.org/framasoft/framaspace/argos/-/merge_requests/14">ajoutÃ© de la documentation</a> pour&nbsp;systemd</p>
<h2 id="mardi-21-novembre-2023">ğŸ—“ï¸ mardi 21 novembre&nbsp;2023</h2>
<p>J&#8217;ai passÃ© un peu de temps Ã  rÃ©pondre a des tickets, merger et faire des petites modifications dans le code, c&#8217;Ã©tait trÃ¨s&nbsp;plaisant.</p>
<p>Il est maintenant <a href="https://framagit.org/framasoft/framaspace/argos/-/merge_requests/8">possible de lancer le serveur depuis l&#8217;extÃ©rieur du venv</a>, et j&#8217;ai lu quelques demandes de modifications de&nbsp;Luc.</p>
<h2 id="jeudi-16-novembre-2023">ğŸ—“ï¸ jeudi 16 novembre&nbsp;2023</h2>
<ul>
<li><a href="https://framagit.org/framasoft/framaspace/argos/-/merge_requests/6">MigrÃ© vers la nouvelle maniÃ¨re de dÃ©finir la config dans&nbsp;Pydantic</a></li>
</ul>
<h2 id="lundi-06-novembre-2023">ğŸ—“ï¸ lundi 06 novembre&nbsp;2023</h2>
<p>J&#8217;ai passÃ© un peu de temps avec Matthieu Leplatre pour faire une revue du code que j&#8217;ai&nbsp;Ã©crit. </p>
<h2 id="jeudi-19-octobre-2023">ğŸ—“ï¸ jeudi 19 octobre&nbsp;2023</h2>
<p>PrÃ©paration de la discussion avec Luc, puis j&#8217;ai ajoutÃ© de la documentation et j&#8217;ai fait pas mal de&nbsp;finitions.</p>
<h2 id="mercredi-18-octobre-2023">ğŸ—“ï¸ mercredi 18 octobre&nbsp;2023</h2>
<p>J&#8217;ai passÃ© une journÃ©e de travail dessus.
Beaucoup de choses faites. La base de code est plus solide, et surtout testÃ©e ce qui me&nbsp;rassure.</p>
<h2 id="mardi-17-octobre-2023">ğŸ—“ï¸ mardi 17 octobre&nbsp;2023</h2>
<ul>
<li>J&#8217;ai ajoutÃ© les dÃ©pendences dans le&nbsp;pyproject.toml</li>
<li>Updated the <span class="caps">CLI</span>&nbsp;interface</li>
</ul>
<h2 id="mercredi-11-octobre-2023">ğŸ—“ï¸ mercredi 11 octobre&nbsp;2023</h2>
<p>J&#8217;ai passÃ© la journÃ©e dessus.Il me reste 3 demi&nbsp;journÃ©es.</p>
<p>J&#8217;ai passÃ© beaucoup de temps Ã  mettre en place des tests au niveau de l&#8217;app. La maniÃ¨re dont l&#8217;application Ã©tait initialisÃ©e ne permettait pas de l&#8217;utiliser dans les tests. Je n&#8217;ai pas tout Ã  fait terminÃ©, mais je pense que c&#8217;est le moment pour essayer de passer Ã  PostgreSQL, parce que c&#8217;est ce qui va tourner en&nbsp;production.</p>
<p>De ce que je comprends, plusieurs approches :
1. Utiliser une connection pool
2. Faire des requÃªtes en asynchrone (voir <a href="https://docs.sqlalchemy.org/en/14/orm/extensions/asyncio.html">la doc</a>)</p>
<p>Je suis vraiment pas loin d&#8217;un truc bien, j&#8217;aimerai quand mÃªme vraiment avoir des tests pour tester les cas limites, lÃ  beaucoup de choses se font Ã  vue et j&#8217;ai peur que des bugs ne se&nbsp;cachent.</p>
<p>Fait&nbsp;:</p>
<ul>
<li>[x] Ajouter une notion de sÃ©vÃ©ritÃ© dans la&nbsp;config</li>
<li>[x] Ajouter une notion de frÃ©quence dans la&nbsp;config</li>
</ul>
<h2 id="mardi-10-octobre-2023">ğŸ—“ï¸ mardi 10 octobre&nbsp;2023</h2>
<ul>
<li>[x] SÃ©curiser les appels des agents au&nbsp;backend</li>
<li>[x] Ajouter le support pour les&nbsp;!include</li>
</ul>
<h2 id="lundi-09-octobre-2023">ğŸ—“ï¸ lundi 09 octobre&nbsp;2023</h2>
<ul>
<li>[x] Terminer le backend de vÃ©rification <span class="caps">SSL</span></li>
<li>[x] DÃ©cider comment faire pour faire remonter les diffÃ©rents niveaux d&#8217;alerte (L&#8217;agent ne devrait pas dÃ©cider, c&#8217;est le travail du&nbsp;serveur)</li>
</ul>
<p>J&#8217;ai pas mal refactorÃ© le code, et c&#8217;est maintenant possible de faire une partie des checks (la finalisation) cÃ´tÃ© serveur. Nous avons aussi maintenant un check <span class="caps">SSL</span>&nbsp;fonctionnel.</p>
<p>La base de donnÃ©es gÃ¨re maintenant une relation, et j&#8217;ai commencÃ© Ã  Ã©crire quelques tests Ã©galement, ainsi que packagÃ© Ã§a dans un package&nbsp;python.</p>
<p>C&#8217;Ã©tait plutÃ´t une journÃ©e un peu dÃ©cousue, mais je suis content du rÃ©sultat. C&#8217;Ã©tait beaucoup de grosses modifications et donc avoir le temps de le faire pour avoir le contexte en tÃªte aide pas&nbsp;mal.</p>
<h2 id="jeudi-05-octobre-2023">ğŸ—“ï¸ jeudi 05 octobre&nbsp;2023</h2>
<p>Je n&#8217;ai pas pris de&nbsp;notes.</p>
<h2 id="mercredi-04-octobre-2023">ğŸ—“ï¸ mercredi 04 octobre&nbsp;2023</h2>
<p>J&#8217;ai pu avancer, mais je me suis confrontÃ© Ã  plusieurs soucis de concentration. Ici au coworking c&#8217;est aussi un endroit pour socialiser, et donc je suis moins efficace. Les pomodoros m&#8217;aident Ã  me recentrer, j&#8217;ai quasiment une <span class="caps">API</span> fonctionnelle. Je galÃ¨re un peu avec Pydantic parce que je ne le connais pas encore bien, j&#8217;espÃ¨re que ce sont des efforts qui vont payer sur le long&nbsp;terme.</p>
<p>La prochaine fois je pense avancer sur les requÃªtes pour ordonnancer tout Ã§a, et faire quelques tests pour valider que tout marche bien comme je&nbsp;veux.</p>
<h2 id="mardi-03-octobre-2023">ğŸ—“ï¸ mardi 03 octobre&nbsp;2023</h2>
<p>Session de travail assez agrÃ©able. J&#8217;ai commencÃ© Ã  faire fonctionner l&#8217;outil, et je commence maintenant Ã  travailler sur les checks en tant que tels. Je sens qu&#8217;il t a quelques fragilitÃ©s au niveau de la structure des donnÃ©es (schÃ©mas / validation avec&nbsp;Pydantic).</p>
<p>Je pense que la prochaine Ã©tape sera de faire tous les checks, et de les faire retourner des donnÃ©es Ã  l&#8217;<span class="caps">API</span>. Puis ensuite de s&#8217;assurer que les jobs ne sont pas distribuÃ©s Ã  plusieurs workers en&nbsp;paralelle.</p>
<h2 id="lundi-02-octobre-2023">ğŸ—“ï¸ lundi 02 octobre&nbsp;2023</h2>
<p>Je suis content de cette session de travail. J&#8217;ai repensÃ© encore une fois le modÃ¨le de donnÃ©es pour arriver Ã  quelque chose qui me semble mieux. J&#8217;ai continuÃ© Ã  travailler sur la codebase avec fastapi que je trouve plus Ã©lÃ©gante et sur laquelle il sera possible de passer en asynchrone&nbsp;ensuite.</p>
<p>Les fichiers de configuration, une fois parsÃ©s, permettent de crÃ©er les enregistrements dans la base de donnÃ©es. La premiÃ¨re version de l&#8217;<span class="caps">API</span> est bientÃ´t prÃªte. La prochaine Ã©tape est de bosser sur les&nbsp;workers.</p>
<h2 id="mercredi-27-septembre-2023">ğŸ—“ï¸ mercredi 27 septembre&nbsp;2023</h2>
<p>1h pour mettre en place un bouncer <span class="caps">ZNC</span>. J&#8217;ai plutÃ´t fait des recherches sur des outils alternatifs pour l&#8217;<span class="caps">API</span>, suite Ã  mon impression de passer du temps Ã  refaire des choses qui sont dÃ©jÃ  fournies par d&#8217;autres outils. J&#8217;espÃ¨re que c&#8217;Ã©tait une bonne idÃ©e ! Le prix Ã  payer pour me remettre le pied Ã  l&#8217;Ã©trier. En fin de journÃ©e j&#8217;ai rÃ©ussi Ã  vraiment rÃ©flÃ©chir au problÃ¨me mÃ©tier, et Ã  dÃ©terminer un bon modÃ¨le de donnÃ©es ainsi que des scÃ©narios d&#8217;utilisation. Au final, je pense qu&#8217;il faut passer par fastapi (qui propose de l&#8217;asynchrone <span class="caps">ASGI</span> de base) mais rester sur SQLAlchemy (Pewee Ã  une <span class="caps">API</span> qui semble plus simple, mais qui ne supporte pas trÃ¨s bien l&#8217;asynchronicitÃ©). Pour la suite, je pense qu&#8217;il faut que je me concentre plus sur les fonctionalitÃ©s de&nbsp;base.</p>
<h2 id="mardi-26-septembre-2023">ğŸ—“ï¸ mardi 26 septembre&nbsp;2023</h2>
<p>J&#8217;ai continuÃ© de bootstrapper et j&#8217;ai importÃ© des bouts de codes qui manquaient pour lancer le serveur web, gÃ©rer la configuration du service, la gestion de la base de donnÃ©es, des migrations&nbsp;etc.</p>
<h2 id="lundi-25-septembre-2023">ğŸ—“ï¸ lundi 25 septembre&nbsp;2023</h2>
<p>J&#8217;ai commencÃ© Ã  boostraper le projet, fait un module qui est capable de lire le fichier de configuration (en <span class="caps">YAML</span>) et de valider que ce qui s&#8217;y trouve est correct. J&#8217;utilise Pydantic pour Ã§a, que je ne connaissais&nbsp;pas.</p>
  </article>
  <script>
    const spec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "width": 500,
      "height": 200,
      "data": 
        {
          "name": "table",
          "values": [
            {"date": "2023-12-16", "series": "RÃ©munÃ©rÃ©", "count": 0},
            {"date": "2023-12-16", "series": "BÃ©nÃ©vole", "count": 5},
            {"date": "2023-12-14", "series": "RÃ©munÃ©rÃ©", "count": 0},
            {"date": "2023-12-14", "series": "BÃ©nÃ©vole", "count": 1},
            {"date": "2023-12-07", "series": "RÃ©munÃ©rÃ©", "count": 0},
            {"date": "2023-12-07", "series": "BÃ©nÃ©vole", "count": 1},
            {"date": "2023-11-23", "series": "RÃ©munÃ©rÃ©", "count": 0},
            {"date": "2023-11-23", "series": "BÃ©nÃ©vole", "count": 1},
            {"date": "2023-11-21", "series": "RÃ©munÃ©rÃ©", "count": 0},
            {"date": "2023-11-21", "series": "BÃ©nÃ©vole", "count": 1},
            {"date": "2023-11-16", "series": "RÃ©munÃ©rÃ©", "count": 0},
            {"date": "2023-11-16", "series": "BÃ©nÃ©vole", "count": 1},
            {"date": "2023-11-06", "series": "RÃ©munÃ©rÃ©", "count": 0},
            {"date": "2023-11-06", "series": "BÃ©nÃ©vole", "count": 2},
            {"date": "2023-10-19", "series": "RÃ©munÃ©rÃ©", "count": 6},
            {"date": "2023-10-19", "series": "BÃ©nÃ©vole", "count": 2},
            {"date": "2023-10-18", "series": "RÃ©munÃ©rÃ©", "count": 7},
            {"date": "2023-10-18", "series": "BÃ©nÃ©vole", "count": 1},
            {"date": "2023-10-17", "series": "RÃ©munÃ©rÃ©", "count": 1},
            {"date": "2023-10-17", "series": "BÃ©nÃ©vole", "count": 0},
            {"date": "2023-10-11", "series": "RÃ©munÃ©rÃ©", "count": 7},
            {"date": "2023-10-11", "series": "BÃ©nÃ©vole", "count": 1},
            {"date": "2023-10-10", "series": "RÃ©munÃ©rÃ©", "count": 5},
            {"date": "2023-10-10", "series": "BÃ©nÃ©vole", "count": 0},
            {"date": "2023-10-09", "series": "RÃ©munÃ©rÃ©", "count": 7},
            {"date": "2023-10-09", "series": "BÃ©nÃ©vole", "count": 0},
            {"date": "2023-10-05", "series": "RÃ©munÃ©rÃ©", "count": 2},
            {"date": "2023-10-05", "series": "BÃ©nÃ©vole", "count": 0},
            {"date": "2023-10-04", "series": "RÃ©munÃ©rÃ©", "count": 4},
            {"date": "2023-10-04", "series": "BÃ©nÃ©vole", "count": 0},
            {"date": "2023-10-03", "series": "RÃ©munÃ©rÃ©", "count": 3},
            {"date": "2023-10-03", "series": "BÃ©nÃ©vole", "count": 0},
            {"date": "2023-10-02", "series": "RÃ©munÃ©rÃ©", "count": 4},
            {"date": "2023-10-02", "series": "BÃ©nÃ©vole", "count": 0},
            {"date": "2023-09-27", "series": "RÃ©munÃ©rÃ©", "count": 4},
            {"date": "2023-09-27", "series": "BÃ©nÃ©vole", "count": 0},
            {"date": "2023-09-26", "series": "RÃ©munÃ©rÃ©", "count": 4},
            {"date": "2023-09-26", "series": "BÃ©nÃ©vole", "count": 0},
            {"date": "2023-09-25", "series": "RÃ©munÃ©rÃ©", "count": 3},
            {"date": "2023-09-25", "series": "BÃ©nÃ©vole", "count": 0},
          ]
        }
      ,
      "mark": "bar",
      "encoding": {
        "x": {
          "timeUnit": {"unit": "", "utc": true},
          "field": "date",
          "axis": {"format": "%d/%m"},
          "title": "Date"
        },
        "y": {
          "aggregate": "sum",
          "field": "count",
          "title": "Heures",
        },
        "color": {
          "field": "series",
          "scale": {
            "domain": ["BÃ©nÃ©vole", "RÃ©munÃ©rÃ©"],
            "range": ["#e7ba52", "#1f77b4"]
          }
        }
      }
    };

  	vegaEmbed("#vis", spec)
    	// result.view provides access to the Vega View API
      .then(result => console.log(result))
      .catch(console.warn);
  </script>
            <footer>
                <a id="feed" href="/feeds/all.atom.xml">
                    <img alt="RSS Logo" src="/theme/rss.svg" />
                </a>
            </footer>
        </div>
    </body>
</html>